<launch>

  <!-- Launch RealSense camera nodes -->
  <include file="$(find realsense_camera)/launch/r200_nodelet_rgbd.launch" />

  <!-- Static transform to link base to camera; TODO replace this with URDF mods -->
  <node name="base2camera" pkg="tf" type="static_transform_publisher" args="-0.005 0 0.165 0 0 0 base_link camera_link 100" />

  <!-- Simulate a laser scanner -->
  <node name="cloud2scan" pkg="depthimage_to_laserscan" type="depthimage_to_laserscan">
    <remap from="image" to="camera/depth/image_rect" />
    <param name="~scan_height" value="10" />
    <param name="~output_frame_id" value="camera_link" /> <!-- Important! -->
  </node>

  <!-- Launch base controller -->
  <node name="driver" pkg="ca_driver" type="ca_driver" output="screen">
    <rosparam>
      loop_hz: 30
      dev: "/dev/ttyUSB0"
      publish_tf: true
      create_1: false
    </rosparam>
  </node>

  <!-- Load robot description -->
  <include file="$(find ca_description)/launch/create_2.launch" />

  <!-- Monitor the battery -->
  <node name="batteryMon" pkg="rodeobot" type="battery_monitor" output="screen" />

  <!-- W3 -->
  <node name="w3" pkg="rodeobot" type="w3_node" output="screen">
    <rosparam>
      x_min_vel: 0.2
      x_max_vel: 0.6
      x_accel: 1.0
      r_min_vel: 0.2
      r_max_vel: 3.0
      r_accel: 2.0
      r_epsilon: 0.05
      scan_width: 0.5 # Min width opening on horizon to move forward
      scan_horizon: 1.1 # Any scan values > this are clipped to this; also Nan and Inf
    </rosparam>
  </node>

</launch>
